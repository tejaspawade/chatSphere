@{
    ViewBag.Title = "Chat";
}

<h2>Real-Time Chat</h2>

<div id="onlineUsers"></div>

<div id="chatBox">
    <ul id="messages"></ul>
</div>

<input id="messageInput" type="text" placeholder="Type a message..." />
<button id="sendBtn">Send</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chathub")
        .build();

    connection.on("ReceiveMessage", (user, message, time) => {
        const li = document.createElement("li");
        li.textContent = `${time} - ${user}: ${message}`;
        document.getElementById("messages").appendChild(li);
    });

    connection.on("UserConnected", username => {
        const div = document.getElementById("onlineUsers");
        div.innerHTML += `<p>${username} is online</p>`;
    });

    connection.on("UserDisconnected", username => {
        const div = document.getElementById("onlineUsers");
        div.innerHTML += `<p>${username} disconnected</p>`;
    });

    document.getElementById("sendBtn").addEventListener("click", async () => {
        const msg = document.getElementById("messageInput").value;
        await connection.invoke("SendMessage", "Me", msg);
        document.getElementById("messageInput").value = "";
    });

    connection.start();
</script>
